<?xml version='1.0'  encoding='UTF-8' ?>
<history>
	<historyItem>
		<sql><![CDATA[select 
   p.person_code, 
   p.person_type, 
   t.person_type_description,
   p.title,
   p.forename, 
   p.surname, 
   p.known_as,
   to_char(b.badge_number) badge_number,
   b.issue_number,
   p.email_address,
   d.department_description,
   decode(safe_get_setting_or_null('use_knownas_in_visitor'), 'Y', nvl(p.known_as,  p.forename ||' '||  p.surname), 'N',  p.forename ||' '||  p.surname) hostname,
   nvl(p.known_as, p.forename ||' '|| p.surname) display_name
from ca_person_interface p
   left join ca_badge b on b.person_code = p.person_code and b.person_type = p.person_type
   left join safe_user u on p.person_code = u.person_code and p.person_type = u.person_type 
   left join ca_kiosk_pin kp on p.person_code = kp.person_code and p.person_type = kp.person_type
   join ca_person_type_control t on p.person_type = t.person_type
   left join ca_department d on p.department_code = d.department_code
where 
   (
      p.pin = :pin_number 
      or 
      kp.pin_number = :pin_number
   )
--   and p.allowed_visitor_ind = 'Y'
   and instr(replace(nvl(safe_get_setting_or_null('badge_status_coexist_with_valid'),'(B)(I)'),'I', 'V'), b.status_ind) > 0
   and rownum = 1]]></sql>
		<connection><![CDATA[Trunk]]></connection>
		<timestamp><![CDATA[1724919762498]]></timestamp>
		<type><![CDATA[SQL]]></type>
		<executed><![CDATA[1]]></executed>
		<execTime><![CDATA[0.167]]></execTime>
	</historyItem>
</history>
